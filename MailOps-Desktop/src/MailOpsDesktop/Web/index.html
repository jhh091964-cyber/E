<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MailOps 郵局搭建精靈</title>
    <link rel="stylesheet" href="css/main.css">

</head>
<body>
    <div class="container">
        <header class="header">
            <h1>📧 MailOps 郵局搭建精靈</h1>
            <p class="subtitle">一鍵搭建您的郵件伺服器 DNS 設定</p>
        </header>

        <div class="progress-bar">
            <div class="step active" data-step="1">
                <span class="step-number">1</span>
                <span class="step-label">資料輸入</span>
            </div>
            <div class="step" data-step="2">
                <span class="step-number">2</span>
                <span class="step-label">環境檢查</span>
            </div>
            <div class="step" data-step="3">
                <span class="step-number">3</span>
                <span class="step-label">DNS 預覽</span>
            </div>
            <div class="step" data-step="4">
                <span class="step-number">4</span>
                <span class="step-label">確認</span>
            </div>
            <div class="step" data-step="5">
                <span class="step-number">5</span>
                <span class="step-label">執行</span>
            </div>
            <div class="step" data-step="6">
                <span class="step-number">6</span>
                <span class="step-label">完成</span>
            </div>
        </div>

        <div class="content-area">
            <!-- Step 1: 基本資料輸入 -->
            <div class="step-content active" id="step1">
                <h2>Step 1/6：基本資料輸入</h2>
                <p class="step-description">請輸入您的 Cloudflare 和 VPS 資訊</p>
                
                <div class="form-group">
                    <label>☁️ Cloudflare 授權金鑰</label>
                    <input 
                        type="password" 
                        id="cloudflareToken" 
                        placeholder="輸入 Cloudflare 授權金鑰"
                        class="form-control"
                    />
                    <p class="help-text">
                        💡 金鑰僅暫存於記憶體中，不會寫入檔案或記錄
                        <a href="https://dash.cloudflare.com/profile/api-tokens" target="_blank">如何取得授權金鑰？</a>
                    </p>
                </div>

                <div class="form-group">
                    <label>🌐 網域名稱 (Domain)</label>
                    <input 
                        type="text" 
                        id="domain" 
                        placeholder="example.com"
                        class="form-control"
                    />
                    <p class="error-text" id="domainError"></p>
                </div>

                <div class="form-group">
                    <label>🖥️ VPS IP 位址</label>
                    <input 
                        type="text" 
                        id="vpsIp" 
                        placeholder="45.xxx.xxx.xxx"
                        class="form-control"
                    />
                    <p class="help-text">⚠️ 請確保此 IP 位址指向您的郵局伺服器</p>
                </div>
            </div>

            <!-- Step 2: 環境檢查 -->
            <div class="step-content" id="step2">
                <h2>Step 2/6：環境檢查</h2>
                <p class="step-description">正在檢查您的環境設定...</p>
                
                <div id="checkResults">
                    <div class="check-item checking" id="checkService">
                        <span class="check-icon">⏳</span>
                        <span class="check-label">Service 狀態</span>
                        <span class="check-status">檢查中...</span>
                    </div>
                    <div class="check-item checking" id="checkToken">
                        <span class="check-icon">⏳</span>
                        <span class="check-label">Cloudflare 授權金鑰</span>
                        <span class="check-status">檢查中...</span>
                    </div>
                    <div class="check-item checking" id="checkDomain">
                        <span class="check-icon">⏳</span>
                        <span class="check-label">網域名稱</span>
                        <span class="check-status">檢查中...</span>
                    </div>
                </div>
            </div>

            <!-- Step 3: DNS 預覽 -->
            <div class="step-content" id="step3">
                <h2>Step 3/6：DNS 預覽</h2>
                <p class="step-description">以下是即將變更的 DNS 記錄</p>
                
                <div id="dnsPreview">
                    <div class="loading">載入中...</div>
                </div>

                <div id="dnsStats" class="stats-panel" style="display: none;">
                    <h3>📊 統計資訊</h3>
                    <div class="stat-item">
                        <span class="stat-label">新增記錄：</span>
                        <span class="stat-value" id="createCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">修改記錄：</span>
                        <span class="stat-value" id="updateCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">刪除記錄：</span>
                        <span class="stat-value" id="deleteCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">總計：</span>
                        <span class="stat-value" id="totalCount">0</span>
                    </div>
                </div>
            </div>

            <!-- Step 4: 確認 -->
            <div class="step-content" id="step4">
                <h2>Step 4/6：使用者確認</h2>
                <p class="step-description">請確認以下資訊無誤</p>
                
                <div class="confirm-panel">
                    <div class="summary-section">
                        <h3>📝 摘要資訊</h3>
                        <p><strong>網域名稱：</strong><span id="confirmDomain"></span></p>
                        <p><strong>VPS IP：</strong><span id="confirmVpsIp"></span></p>
                        <p><strong>變更數量：</strong><span id="confirmCount"></span></p>
                    </div>

                    <div class="warning-section">
                        <h3>⚠️ 風險提示</h3>
                        <ul>
                            <li>DNS 變更會立即生效</li>
                            <li>錯誤的設定可能導致郵件無法收發</li>
                            <li>建議先在測試環境驗證</li>
                        </ul>
                    </div>

                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="confirmCheckbox">
                            <span>我已閱讀並了解上述說明，確認執行</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Step 5: 執行 -->
            <div class="step-content" id="step5">
                <h2>Step 5/6：執行流程</h2>
                <p class="step-description">正在執行 DNS 變更...</p>
                
                <div id="executeProgress">
                    <div class="progress-steps">
                        <div class="progress-item" id="stepPreview">
                            <span class="step-icon">⏳</span>
                            <span class="step-name">1. DNS 預覽</span>
                            <span class="step-status">等待中</span>
                        </div>
                        <div class="progress-item" id="stepConfirm">
                            <span class="step-icon">⏸️</span>
                            <span class="step-name">2. 生成安全碼</span>
                            <span class="step-status">等待中</span>
                        </div>
                        <div class="progress-item" id="stepValidate">
                            <span class="step-icon">⏸️</span>
                            <span class="step-name">3. 驗證安全碼</span>
                            <span class="step-status">等待中</span>
                        </div>
                        <div class="progress-item" id="stepExecute">
                            <span class="step-icon">⏸️</span>
                            <span class="step-name">4. 執行 DNS 寫入</span>
                            <span class="step-status">等待中</span>
                        </div>
                    </div>

                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <span class="progress-text" id="progressText">0%</span>
                    </div>
                </div>
            </div>

            <!-- Step 6: 完成 -->
            <div class="step-content" id="step6">
                <h2>Step 6/6：完成</h2>
                
                <div id="resultSuccess" class="result-panel success" style="display: none;">
                    <h3>✅ 郵局搭建完成！</h3>
                    <div class="result-content">
                        <p><strong>網域名稱：</strong><span id="successDomain"></span></p>
                        <p><strong>完成時間：</strong><span id="successTime"></span></p>
                    </div>

                    <div class="next-steps">
                        <h3>📝 後續步驟</h3>
                        <ol>
                            <li>DNS 生效時間：5-10 分鐘</li>
                            <li>配置郵件伺服器（Postfix/Dovecot）</li>
                            <li>測試郵件收發功能</li>
                            <li>設置反垃圾郵件規則</li>
                        </ol>
                    </div>
                </div>

                <div id="resultFailure" class="result-panel failure" style="display: none;">
                    <h3>❌ 郵局搭建失敗</h3>
                    <div class="result-content">
                        <p><strong>錯誤訊息：</strong><span id="errorMessage"></span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="navigation-buttons">
            <button class="btn btn-secondary" id="btnPrev" disabled>上一步</button>
            <button class="btn btn-primary" id="btnNext">下一步</button>
        </div>
    </div>

    <script src="js/wizard.js"></script>
</body>
</html>